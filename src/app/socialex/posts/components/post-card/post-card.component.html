<article class="rounded-md border border-gray-700">
  <div class="flex flex-col">
    <div class="flex flex-col relative">
      <post-card-content [post]="post()" [userResource]="userPostResource.value()" />
      <div class="w-full flex justify-between items-center px-3 py-2">
        @if (totalReactionsCount() > 0) {
        <div
          class="flex items-center gap-2 mr-auto cursor-pointer hover:underline relative group z-5"
          (click)="openReactionsModal(post().id)"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 20 20"
          >
            <rect width="20" height="20" fill="none" />
            <path
              fill="currentColor"
              d="M7.993 6.003h-.719a7 7 0 0 0 .339-1.118c.098-.486.142-1.054-.019-1.573c-.17-.55-.56-1.009-1.234-1.235c-.863-.289-1.608.317-1.924.925L3.143 5.49a2.5 2.5 0 0 1-.976 1.017l-1.161.665a2 2 0 0 0-.88 2.435l.311.834a2 2 0 0 0 1.313 1.22l4.243 1.24a2.5 2.5 0 0 0 3.09-1.66l.82-2.646a2 2 0 0 0-1.91-2.592m4.733 8h-.719a2 2 0 0 1-1.91-2.593l.82-2.646a2.5 2.5 0 0 1 3.09-1.66l4.243 1.24a2 2 0 0 1 1.313 1.22l.311.835a2 2 0 0 1-.88 2.435l-1.161.665a2.5 2.5 0 0 0-.976 1.016l-1.293 2.488c-.316.608-1.06 1.214-1.924.925c-.674-.226-1.064-.685-1.234-1.235c-.16-.518-.118-1.087-.019-1.573c.084-.414.216-.805.338-1.117"
            />
          </svg>
          <span class="text-xs">{{ totalReactionsCount() }}</span>
          <div
            class="absolute z-5 opacity-0 transition-opacity pointer-events-none bottom-full left-0 w-max h-max flex flex-col gap-1 bg-gray-200 rounded-md p-2 group-hover:opacity-100"
          >
            @for (user of reactionsResource.value() | limitCountActivity:5 ; track user) {
            <span class="text-sm text-gray-800 leading-4">{{ user.name }}</span>
            }
          </div>
        </div>
        }
        @if (totalCommentsResource.hasValue() && totalCommentsResource.value() > 0) {
        <div
          class="flex items-center gap-2 ml-auto cursor-pointer hover:underline relative group z-5"
        >
          <span (click)="toggleCommentPost(post().id)">{{
            totalCommentsResource.value() | i18nPlural : i18nPluralPipeComments
          }}</span>
          <div
            class="absolute z-5 opacity-0 transition-opacity pointer-events-none bottom-full right-0 w-max h-max flex flex-col gap-1 bg-gray-200 rounded-md p-2 group-hover:opacity-100"
          >
            @for (user of commentsResource.value() | limitCountActivity:5 ; track user) {
            <span class="text-sm text-gray-800 leading-4">{{ user.name }}</span>
            }
          </div>
        </div>
        }
      </div>
      @if (authService.authStatus() === 'authenticated' && uiService.showReactionAction() === post().id) {
        <reaction-action [post]="post()" />
      }
      <div class="border-b border-gray-600 mx-3"></div>
    </div>
    <div class="flex items-center gap-2 px-3 py-1 overflow-hidden">
      <button
        type="button"
        (click)="uiService.openReactionAction(post().id)"
        class="text-sm flex items-center justify-center gap-2 text-gray-300 p-1.5 grow cursor-pointer transition-colors rounded-lg hover:bg-zinc-800"
        [class.bg-base-100]="uiService.getReactionForPost(post().id)"
      >
        @if (!postsService.hasPreviousAnyReaction(post().id)) {
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            class="user-select-none pointer-events-none"
          >
            <rect width="20" height="20" fill="none" />
            <path
              fill="currentColor"
              d="M5.324 3.463c.2-.385.52-.504.718-.437c.356.119.518.326.597.582c.089.287.078.663-.006 1.079a6 6 0 0 1-.351 1.102a7 7 0 0 1-.207.448l-.012.023l-.003.005a.5.5 0 0 0 .44.738h1.493a1 1 0 0 1 .955 1.296l-.82 2.646a1.5 1.5 0 0 1-1.854.996l-4.244-1.24a1 1 0 0 1-.656-.61l-.312-.834a1 1 0 0 1 .44-1.218l1.162-.664A3.5 3.5 0 0 0 4.03 5.95zm2.669 2.54h-.719a7 7 0 0 0 .339-1.118c.098-.486.142-1.054-.019-1.573c-.17-.55-.56-1.009-1.234-1.235c-.863-.289-1.608.317-1.924.925L3.143 5.49a2.5 2.5 0 0 1-.976 1.017l-1.161.665a2 2 0 0 0-.88 2.435l.311.834a2 2 0 0 0 1.313 1.22l4.243 1.24a2.5 2.5 0 0 0 3.09-1.66l.82-2.646a2 2 0 0 0-1.91-2.592m6.683 10.54c-.2.385-.52.503-.718.437c-.356-.12-.518-.327-.597-.582c-.089-.288-.078-.664.006-1.08c.082-.406.225-.802.351-1.101a7 7 0 0 1 .207-.449l.012-.023l.003-.005a.5.5 0 0 0-.44-.737h-1.493a1 1 0 0 1-.955-1.297l.82-2.646a1.5 1.5 0 0 1 1.854-.996l4.243 1.24a1 1 0 0 1 .657.61l.311.834a1 1 0 0 1-.44 1.218l-1.16.665a3.5 3.5 0 0 0-1.368 1.423zm-2.669-2.54h.719a7 7 0 0 0-.339 1.117c-.099.487-.142 1.055.019 1.573c.17.55.56 1.01 1.234 1.235c.863.289 1.608-.317 1.924-.925l1.293-2.488a2.5 2.5 0 0 1 .976-1.017l1.161-.664a2 2 0 0 0 .88-2.435l-.311-.835a2 2 0 0 0-1.313-1.22l-4.244-1.24a2.5 2.5 0 0 0-3.089 1.66l-.82 2.646a2 2 0 0 0 1.91 2.592"
            />
          </svg>
          <span class="user-select-none pointer-events-none">Reaccionar</span>
        } @else {
          @if (uiService.getReactionForPost(post().id)) {
            <div class="flex items-center gap-2">
              <img
                [srcset]="uiService.getReactionForPost(post().id)?.icon"
                alt="icon"
                class="w-5 aspect-square"
              />
              <span class="text-xs">{{ uiService.getReactionForPost(post().id)?.title }}</span>
            </div>
          }
        }
      </button>
      <button
        type="button"
        class="text-sm flex items-center justify-center gap-2 text-gray-300 p-1.5 grow cursor-pointer transition-colors rounded-lg hover:bg-zinc-800"
        (click)="toggleCommentPost(post().id)"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
        >
          <rect width="24" height="24" fill="none" />
          <path
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1.5"
            d="M12 21a9 9 0 1 0-9-9c0 1.488.36 2.89 1 4.127L3 21l4.873-1c1.236.639 2.64 1 4.127 1"
          />
        </svg>
        Comentar
      </button>
    </div>
    <div class="border-b border-gray-600 mx-3" [class.hidden]="!openCommentPostId()"></div>
    <post-card-comments [post]="post()" [openComment]="openCommentPostId()" />
  </div>
  @if (openModalReactionsByPostId() === post().id) {
    <modal-reactions [postId]="post().id" class="modal-reactions fixed inset-0 z-50" (closeModalReactions)="closeReactionsModal()" />
  }
</article>